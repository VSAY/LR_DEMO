YUI.add('gallery-y-common-infinite-scroll',function(Y,NAME){var EV_LOADING='infinite-scroll:loading';var EV_FINISHED='infinite-scroll:finished';var EV_NO_MORE_RESULTS='infinite-scroll:no-more-results';Y.InfiniteScroll=Y.Base.create('gallery-y-common-infinite-scroll',Y.Base,[],{updateInitiated:false,currentOffset:null,allItemsFetched:false,initializer:function(){this.firstTime=true;this.currentOffset=this.get('offset');if(this.get('initialize')){this._onScroll();}
Y.one(window).on('scroll',Y.bind(function(){this._onScroll();},this));},_onScroll:function(){var me=this;var scrollPos=0;if(this.updateInitiated){return;}
var pageHeight=document.documentElement.scrollHeight;var clientHeight=document.documentElement.clientHeight;if(Y.UA.ie){scrollPos=document.documentElement.scrollTop;}else{scrollPos=window.pageYOffset;}
if((this.firstTime||pageHeight-(scrollPos+clientHeight)<this.get('scrollBufferSize'))&&!this.allItemsFetched){this.updateInitiated=true;var offset=this.get('container').all('.item').size();this.fire(EV_LOADING);document.documentElement.scrollTop+=this.get('scrollBufferSize');if(this.get('requestCustomData')){Y.bind(this.get('requestCustomData'),this)(function(response){me._processResponse(response);me.updateInitiated=false;});}else{this.requestItems();}
if(this.firstTime){this.firstTime=false;}}},requestItems:function(){var me=this;var url=Y.Lang.sub(this.get('dataSourceUrl'),{offset:this.currentOffset});var oConn=Y.io(url,{on:{success:function(id,o,args){var resp=Y.JSON.parse(o.responseText);me._processResponse(resp);},complete:function(id,o,args){me.updateInitiated=false;}}});},_processResponse:function(response){var me=this;me.currentOffset+=me.get('offset');if(response.length>0){var elems=[];var fragment=document.createDocumentFragment();Y.Array.each(response,function(item){item=me.get('itemPreProcessor')(item);var div=document.createElement('div');$(div).append(Y.Lang.sub(me.get('itemTemplate'),item));fragment.appendChild(div);elems.push(div);});$('#masonry_container').masonry({itemSelector:'.item',columnWidth:3}).append(fragment).masonry('appended',elems);$("#masonry_container").imagesLoaded(function(){$('#masonry_container').masonry({itemSelector:'.item',columnWidth:3,isAnimated:true,animationOptions:{duration:700,easing:'linear',queue:false}});});}else{me.fire(EV_NO_MORE_RESULTS);me.allItemsFetched=true;}
me.fire(EV_FINISHED);}},{ATTRS:{dataSourceUrl:{value:''},container:{value:null},itemTemplate:{value:''},offset:{value:15},initialize:{value:false},requestCustomData:{value:null},itemPreProcessor:{value:function(item){return item;}},scrollBufferSize:{value:60}}});},'@VERSION@',{"requires":["yui-base","widget","base","node","node-event-delegate","event","io-base","json-parse"]});